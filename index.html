<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>StaffHealth Workforce Stability Index (WSI)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    /* === Global layout & colors (aligned to original SHSI) === */
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      background: #f4f5f7;
      color: #222222;
    }

    /* === SHSI-style top header & mode banner === */
    .shsi-header {
      width: 100%;
      margin: 0;
      padding: 0;
    }

    .shsi-hero {
      background: #111111;
      color: #ffffff;
      text-align: center;
      padding: 18px 12px 14px;
    }

    .shsi-title {
      font-size: 1.2rem;
      font-weight: 700;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .shsi-title-brand {
      color: #1f66d1; /* StaffHealth blue accent */
      margin-right: 4px;
    }

    .shsi-title-main {
      color: #ffffff;
    }

    .shsi-tagline {
      margin-top: 6px;
      font-size: 0.8rem;
      color: #dddddd;
      max-width: 880px;
      margin-left: auto;
      margin-right: auto;
    }

    .shsi-mode-banner {
      background: #1f66d1;
      color: #ffffff;
      text-align: center;
      font-size: 0.78rem;
      font-weight: 600;
      padding: 6px 10px;
      letter-spacing: 0.05em;
      text-transform: uppercase;
    }

    /* === Main page content === */
    .page {
      max-width: 1100px;
      margin: 18px auto 40px;
      padding: 0 16px 40px;
    }

    h1 {
      font-size: 1.7rem;
      margin-bottom: 4px;
      font-weight: 700;
    }

    h2 {
      font-size: 1.2rem;
      margin: 20px 0 8px;
      font-weight: 600;
      color: #0054a6;
    }

    p {
      margin: 4px 0;
      line-height: 1.5;
    }

    .subtitle {
      color: #555;
      margin-bottom: 16px;
      max-width: 840px;
      font-size: 0.9rem;
    }

    /* === Cards & grids === */
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 16px;
      margin-top: 16px;
    }

    .card {
      background: #ffffff;
      border-radius: 10px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.08);
      padding: 16px 16px 18px;
      border: 1px solid #e0e3eb;
    }

    .card h3 {
      margin-top: 0;
      margin-bottom: 6px;
      font-size: 1rem;
      font-weight: 600;
      color: #222;
    }

    .card p {
      font-size: 0.8rem;
      color: #666;
      margin-bottom: 8px;
    }

    .dim-label {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .field {
      margin-bottom: 8px;
    }

    .field label {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      font-size: 0.86rem;
      margin-bottom: 2px;
    }

    .field small {
      color: #777;
      font-size: 0.75rem;
      margin-left: 6px;
    }

    input[type="number"] {
      width: 100%;
      padding: 5px 6px;
      border-radius: 6px;
      border: 1px solid #d0d4dc;
      font-size: 0.88rem;
      box-sizing: border-box;
      font-family: inherit;
    }

    input[type="number"]:focus {
      outline: none;
      border-color: #0054a6;
      box-shadow: 0 0 0 2px rgba(0,84,166,0.16);
    }

    /* Mode card */
    .mode-card {
      margin-bottom: 16px;
    }

    .mode-options {
      margin-top: 6px;
      margin-bottom: 4px;
    }

    .mode-options label {
      display: block;
      font-size: 0.86rem;
      margin-bottom: 4px;
      cursor: pointer;
    }

    .mode-options input {
      margin-right: 6px;
    }

    /* Show/hide depending on mode */
    .single-only { display: block; }
    .portfolio-only { display: none; }

    body.mode-portfolio .single-only { display: none; }
    body.mode-portfolio .portfolio-only { display: block; }

    /* Portfolio distribution table */
    .dist-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.8rem;
      margin-top: 4px;
    }

    .dist-table th,
    .dist-table td {
      padding: 4px 6px;
      border-bottom: 1px solid #e0e3ea;
      text-align: left;
    }

    .dist-table th {
      background: #f3f4f8;
      font-weight: 600;
    }

    .dist-bands {
      font-size: 0.76rem;
      color: #666;
    }

    .small-input {
      width: 70px;
      padding: 3px 4px;
      font-size: 0.8rem;
    }

    .total-cell {
      font-size: 0.78rem;
      font-weight: 600;
      text-align: right;
      min-width: 80px;
    }

    /* Summary layout */
    .summary-grid {
      display: grid;
      grid-template-columns: minmax(0, 1.5fr) minmax(0, 1fr);
      gap: 16px;
      margin-top: 20px;
    }

    .summary-main {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .score-badge {
      display: inline-flex;
      align-items: baseline;
      gap: 8px;
      margin-top: 4px;
    }

    .score-number {
      font-size: 2.2rem;
      font-weight: 700;
      color: #0054a6;
    }

    .score-tag {
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 0.75rem;
      font-weight: 600;
      border: 1px solid #ccc;
      text-transform: uppercase;
      letter-spacing: .03em;
      background: #f5f6fb;
      color: #444;
    }

    .score-tag.high-risk {
      border-color: #e5533d;
      color: #b12c1c;
      background: #fde8e5;
    }

    .score-tag.moderate-risk {
      border-color: #f0aa2c;
      color: #8a5a00;
      background: #fff3db;
    }

    .score-tag.stable {
      border-color: #3e9153;
      color: #1f6b33;
      background: #e4f6e8;
    }

    .kpi-row {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      margin-top: 8px;
    }

    .kpi {
      flex: 1 1 180px;
      background: #f8f9fb;
      border-radius: 8px;
      padding: 8px 10px;
      font-size: 0.86rem;
      border: 1px solid #e0e3ea;
    }

    .kpi-label {
      color: #666;
      margin-bottom: 4px;
    }

    .kpi-value {
      font-weight: 600;
      font-size: 0.98rem;
      color: #222;
    }

    .scenario-card h4 {
      margin: 0 0 6px;
      font-size: 0.95rem;
      color: #222;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 6px;
      font-size: 0.82rem;
    }

    th, td {
      padding: 6px 8px;
      text-align: left;
      border-bottom: 1px solid #e0e3ea;
    }

    th {
      background: #f3f4f8;
      font-weight: 600;
      color: #222;
    }

    .delta-positive {
      color: #1f6b33;
      font-weight: 600;
    }

    .delta-negative {
      color: #b12c1c;
      font-weight: 600;
    }

    .note {
      font-size: 0.78rem;
      color: #777;
      margin-top: 6px;
    }

    .footer-note {
      margin-top: 20px;
      font-size: 0.78rem;
      color: #777;
      max-width: 860px;
    }

    @media (max-width: 720px) {
      .summary-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body class="mode-single">
  <!-- Shared SHSI-style header -->
  <div class="shsi-header">
    <div class="shsi-hero">
      <div class="shsi-title">
        <span class="shsi-title-brand">STAFFHEALTH</span>
        <span class="shsi-title-main">STABILITY INDEX™</span>
      </div>
      <div class="shsi-tagline">
        Directional diagnostic that scores staffing “health” across volatility, risk, and workforce stability —
        designed for single communities or portfolios. This screen is the Workforce Stability (WSI) view.
      </div>
    </div>
    <div class="shsi-mode-banner" id="modeBanner">
      SINGLE COMMUNITY MODE — WORKFORCE STABILITY EDITION (WSI)
    </div>
  </div>

  <!-- Main WSI content -->
  <div class="page">
    <h1 id="snapshotTitle">Workforce Stability Snapshot</h1>
    <p class="subtitle" id="snapshotSubtitle">
      Adjust the inputs below to see how staffing volatility, financial exposure, operational risk, and workforce pipeline strength
      roll up into a single Workforce Stability Index and economic view.
    </p>

    <!-- 1. Select Mode -->
    <div class="card mode-card">
      <h3>1. Select Mode</h3>
      <p style="font-size:0.82rem; color:#555;">
        Use <strong>Single Community Mode</strong> for ED / building-level discussions.
        Use <strong>Portfolio Mode</strong> for VP Ops / portfolio roll-ups using distributions of communities across risk bands.
      </p>
      <div class="mode-options">
        <label>
          <input type="radio" name="mode" value="single" checked />
          Single Community Mode (ED / building-level)
        </label>
        <label>
          <input type="radio" name="mode" value="portfolio" />
          Portfolio Mode (VP Ops / portfolio roll-up)
        </label>
      </div>
      <p class="note">
        In Portfolio Mode, you enter how many communities fall into each risk band for every metric. The tool calculates portfolio-wide
        averages and rolls them into a single WSI score and economic view.
      </p>
    </div>

    <!-- SINGLE COMMUNITY INPUT GRID -->
    <div class="grid single-only">
      <!-- Dimension 1: Staffing Volatility -->
      <div class="card">
        <h3>2. Staffing Volatility</h3>
        <p>
          How choppy is the current schedule? These inputs capture day-to-day instability on the floor.
        </p>
        <div class="field">
          <label>
            <span>Open shifts per week</span>
            <small>0–50</small>
          </label>
          <input type="number" id="openShifts" min="0" max="50" value="8" />
        </div>
        <div class="field">
          <label>
            <span>% of shifts covered by agency/PRN</span>
            <small>0–100%</small>
          </label>
          <input type="number" id="percentPRN" min="0" max="100" value="35" />
        </div>
        <div class="field">
          <label>
            <span>Last-minute call-offs per week</span>
            <small>0–20</small>
          </label>
          <input type="number" id="callOffs" min="0" max="20" value="4" />
        </div>
      </div>

      <!-- Dimension 2: Financial Exposure -->
      <div class="card">
        <h3>3. Financial Exposure</h3>
        <p>
          Direct cost impact of volatility — especially overtime and premium labor.
        </p>
        <div class="field">
          <label>
            <span>Monthly overtime hours</span>
            <small>0–500</small>
          </label>
          <input type="number" id="otHours" min="0" max="500" value="120" />
        </div>
        <div class="field">
          <label>
            <span>Overtime premium (% above base)</span>
            <small>0–100%</small>
          </label>
          <input type="number" id="otPremium" min="0" max="100" value="50" />
        </div>
        <div class="field">
          <label>
            <span>Agency/PRN premium (% vs core staff)</span>
            <small>0–100%</small>
          </label>
          <input type="number" id="agencyPremium" min="0" max="100" value="35" />
        </div>
      </div>

      <!-- Dimension 3: Operational & Compliance Risk -->
      <div class="card">
        <h3>4. Operational &amp; Compliance Risk</h3>
        <p>
          Downstream impacts: PBJ, surveys, and leadership drag from instability.
        </p>
        <div class="field">
          <label>
            <span>PBJ exposure / risk score</span>
            <small>0–10 (10 = high risk)</small>
          </label>
          <input type="number" id="pbjRisk" min="0" max="10" value="6" />
        </div>
        <div class="field">
          <label>
            <span>Survey citations related to staffing (last 12 mo)</span>
            <small>0–10</small>
          </label>
          <input type="number" id="surveyCitations" min="0" max="10" value="2" />
        </div>
        <div class="field">
          <label>
            <span>Leadership turnover events (ED/DON/ADON, last 12 mo)</span>
            <small>0–10</small>
          </label>
          <input type="number" id="leaderTurnover" min="0" max="10" value="1" />
        </div>
      </div>

      <!-- Dimension 4: Workforce Stability (Pipeline) -->
      <div class="card">
        <h3>5. Workforce Stability (Pipeline)</h3>
        <p>
          How strong is the permanent staff pipeline? This is where candidate sourcing moves the needle.
        </p>
        <div class="field">
          <label>
            <span>Annual clinical staff turnover rate</span>
            <small>0–100%</small>
          </label>
          <input type="number" id="turnoverRate" min="0" max="100" value="60" />
        </div>
        <div class="field">
          <label>
            <span>Open clinical FTE vacancies</span>
            <small>0–20</small>
          </label>
          <input type="number" id="vacancies" min="0" max="20" value="4" />
        </div>
        <div class="field">
          <label>
            <span>Average time-to-fill for key roles (RN/LVN/CNA)</span>
            <small>0–120 days</small>
          </label>
          <input type="number" id="timeToFill" min="0" max="120" value="60" />
        </div>
        <div class="field">
          <label>
            <span>Monthly external recruiting spend</span>
            <small>$0–$50,000</small>
          </label>
          <input type="number" id="recruitSpend" min="0" max="50000" value="8000" />
        </div>
      </div>
    </div>

    <!-- PORTFOLIO DISTRIBUTION INPUTS -->
    <div class="grid portfolio-only">
      <!-- Portfolio context + staffing volatility dist -->
      <div class="card">
        <h3>2. Portfolio Context & Staffing Volatility</h3>
        <p style="font-size:0.8rem; color:#555;">
          Enter how many communities fall into each band. The tool converts this into portfolio-wide average values.
        </p>
        <div class="field">
          <label>
            <span>Total communities in this portfolio</span>
            <small>(for your reference)</small>
          </label>
          <input type="number" id="portfolioSize" min="1" max="200" value="20" />
        </div>

        <table class="dist-table">
          <thead>
            <tr>
              <th>Metric</th>
              <th>Low band</th>
              <th>Mid band</th>
              <th>High band</th>
              <th>Total</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>
                Open shifts / week
                <div class="dist-bands">0–5 • 6–10 • 11+</div>
              </td>
              <td><input type="number" id="openShiftsLow" class="small-input" min="0" value="6" /></td>
              <td><input type="number" id="openShiftsMid" class="small-input" min="0" value="9" /></td>
              <td><input type="number" id="openShiftsHigh" class="small-input" min="0" value="5" /></td>
              <td class="total-cell"><span id="totalOpenShifts">0 / 0</span></td>
            </tr>
            <tr>
              <td>
                % of shifts via agency/PRN
                <div class="dist-bands">0–25% • 26–50% • 51%+</div>
              </td>
              <td><input type="number" id="percentPRNLow" class="small-input" min="0" value="7" /></td>
              <td><input type="number" id="percentPRNMid" class="small-input" min="0" value="8" /></td>
              <td><input type="number" id="percentPRNHigh" class="small-input" min="0" value="5" /></td>
              <td class="total-cell"><span id="totalPercentPRN">0 / 0</span></td>
            </tr>
            <tr>
              <td>
                Last-minute call-offs / week
                <div class="dist-bands">0–2 • 3–5 • 6+</div>
              </td>
              <td><input type="number" id="callOffsLow" class="small-input" min="0" value="8" /></td>
              <td><input type="number" id="callOffsMid" class="small-input" min="0" value="7" /></td>
              <td><input type="number" id="callOffsHigh" class="small-input" min="0" value="5" /></td>
              <td class="total-cell"><span id="totalCallOffs">0 / 0</span></td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Financial exposure dist -->
      <div class="card">
        <h3>3. Financial Exposure (Portfolio)</h3>
        <table class="dist-table">
          <thead>
            <tr>
              <th>Metric</th>
              <th>Low band</th>
              <th>Mid band</th>
              <th>High band</th>
              <th>Total</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>
                Monthly OT hours
                <div class="dist-bands">0–100 • 101–250 • 251+</div>
              </td>
              <td><input type="number" id="otHoursLow" class="small-input" min="0" value="7" /></td>
              <td><input type="number" id="otHoursMid" class="small-input" min="0" value="9" /></td>
              <td><input type="number" id="otHoursHigh" class="small-input" min="0" value="4" /></td>
              <td class="total-cell"><span id="totalOtHours">0 / 0</span></td>
            </tr>
            <tr>
              <td>
                OT premium vs base
                <div class="dist-bands">0–25% • 26–50% • 51%+</div>
              </td>
              <td><input type="number" id="otPremiumLow" class="small-input" min="0" value="6" /></td>
              <td><input type="number" id="otPremiumMid" class="small-input" min="0" value="9" /></td>
              <td><input type="number" id="otPremiumHigh" class="small-input" min="0" value="5" /></td>
              <td class="total-cell"><span id="totalOtPremium">0 / 0</span></td>
            </tr>
            <tr>
              <td>
                Agency/PRN premium vs core staff
                <div class="dist-bands">0–20% • 21–40% • 41%+</div>
              </td>
              <td><input type="number" id="agencyPremiumLow" class="small-input" min="0" value="5" /></td>
              <td><input type="number" id="agencyPremiumMid" class="small-input" min="0" value="10" /></td>
              <td><input type="number" id="agencyPremiumHigh" class="small-input" min="0" value="5" /></td>
              <td class="total-cell"><span id="totalAgencyPremium">0 / 0</span></td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Operational & compliance dist -->
      <div class="card">
        <h3>4. Operational &amp; Compliance Risk (Portfolio)</h3>
        <table class="dist-table">
          <thead>
            <tr>
              <th>Metric</th>
              <th>Low band</th>
              <th>Mid band</th>
              <th>High band</th>
              <th>Total</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>
                PBJ exposure / risk score
                <div class="dist-bands">0–3 • 4–7 • 8–10</div>
              </td>
              <td><input type="number" id="pbjRiskLow" class="small-input" min="0" value="8" /></td>
              <td><input type="number" id="pbjRiskMid" class="small-input" min="0" value="7" /></td>
              <td><input type="number" id="pbjRiskHigh" class="small-input" min="0" value="5" /></td>
              <td class="total-cell"><span id="totalPbjRisk">0 / 0</span></td>
            </tr>
            <tr>
              <td>
                Staffing-related survey citations (12 mo)
                <div class="dist-bands">0 • 1–2 • 3+</div>
              </td>
              <td><input type="number" id="surveyCitationsLow" class="small-input" min="0" value="9" /></td>
              <td><input type="number" id="surveyCitationsMid" class="small-input" min="0" value="7" /></td>
              <td><input type="number" id="surveyCitationsHigh" class="small-input" min="0" value="4" /></td>
              <td class="total-cell"><span id="totalSurveyCitations">0 / 0</span></td>
            </tr>
            <tr>
              <td>
                Leadership turnover events (ED/DON/ADON, 12 mo)
                <div class="dist-bands">0–1 • 2–3 • 4+</div>
              </td>
              <td><input type="number" id="leaderTurnoverLow" class="small-input" min="0" value="10" /></td>
              <td><input type="number" id="leaderTurnoverMid" class="small-input" min="0" value="6" /></td>
              <td><input type="number" id="leaderTurnoverHigh" class="small-input" min="0" value="4" /></td>
              <td class="total-cell"><span id="totalLeaderTurnover">0 / 0</span></td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Workforce stability dist -->
      <div class="card">
        <h3>5. Workforce Stability (Pipeline) — Portfolio</h3>
        <table class="dist-table">
          <thead>
            <tr>
              <th>Metric</th>
              <th>Low band</th>
              <th>Mid band</th>
              <th>High band</th>
              <th>Total</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>
                Annual clinical staff turnover rate
                <div class="dist-bands">0–30% • 31–60% • 61%+</div>
              </td>
              <td><input type="number" id="turnoverRateLow" class="small-input" min="0" value="5" /></td>
              <td><input type="number" id="turnoverRateMid" class="small-input" min="0" value="9" /></td>
              <td><input type="number" id="turnoverRateHigh" class="small-input" min="0" value="6" /></td>
              <td class="total-cell"><span id="totalTurnoverRate">0 / 0</span></td>
            </tr>
            <tr>
              <td>
                Open clinical FTE vacancies
                <div class="dist-bands">0–1 • 2–4 • 5+</div>
              </td>
              <td><input type="number" id="vacanciesLow" class="small-input" min="0" value="7" /></td>
              <td><input type="number" id="vacanciesMid" class="small-input" min="0" value="8" /></td>
              <td><input type="number" id="vacanciesHigh" class="small-input" min="0" value="5" /></td>
              <td class="total-cell"><span id="totalVacancies">0 / 0</span></td>
            </tr>
            <tr>
              <td>
                Average time-to-fill (RN/LVN/CNA)
                <div class="dist-bands">0–30 d • 31–60 d • 61+ d</div>
              </td>
              <td><input type="number" id="timeToFillLow" class="small-input" min="0" value="6" /></td>
              <td><input type="number" id="timeToFillMid" class="small-input" min="0" value="9" /></td>
              <td><input type="number" id="timeToFillHigh" class="small-input" min="0" value="5" /></td>
              <td class="total-cell"><span id="totalTimeToFill">0 / 0</span></td>
            </tr>
            <tr>
              <td>
                Monthly external recruiting spend
                <div class="dist-bands">$0–$5k • $5,001–$15k • $15k+</div>
              </td>
              <td><input type="number" id="recruitSpendLow" class="small-input" min="0" value="8" /></td>
              <td><input type="number" id="recruitSpendMid" class="small-input" min="0" value="7" /></td>
              <td><input type="number" id="recruitSpendHigh" class="small-input" min="0" value="5" /></td>
              <td class="total-cell"><span id="totalRecruitSpend">0 / 0</span></td>
            </tr>
          </tbody>
        </table>
        <p class="note">
          Band definitions are directional. The model converts these distributions into portfolio-wide average values for each metric.
        </p>
      </div>
    </div>

    <!-- SUMMARY / OUTPUT -->
    <div class="summary-grid">
      <div class="card summary-main">
        <h2>Stability Index & Economics</h2>
        <p style="font-size:0.86rem; color:#555;">
          This summarizes the current state of the workforce and the modeled economic impact of volatility and pipeline weakness.
        </p>

        <div>
          <div class="dim-label">Overall Workforce Stability Index (0–100)</div>
          <div class="score-badge">
            <span class="score-number" id="shsiScore">–</span>
            <span class="score-tag" id="scoreTag">Calculating…</span>
          </div>
        </div>

        <div class="kpi-row">
          <div class="kpi">
            <div class="kpi-label">Estimated Annual Volatility Cost</div>
            <div class="kpi-value" id="volCost">$–</div>
          </div>
          <div class="kpi">
            <div class="kpi-label">Stabilizable Upside (StaffHealth + Verified)</div>
            <div class="kpi-value" id="stabilizableUpside">$–</div>
          </div>
          <div class="kpi">
            <div class="kpi-label">Workforce Drag Cost (Pipeline Weakness)</div>
            <div class="kpi-value" id="workforceDrag">$–</div>
          </div>
        </div>

        <p class="note">
          Dollar figures are modeled estimates to frame the economic story. Assumptions
          (e.g., max volatility impact, stabilizable percentage) can be tuned with your PE / finance partners.
        </p>
      </div>

      <div class="card scenario-card">
        <h2>Candidate Sourcing Scenario</h2>
        <p style="font-size:0.82rem; color:#555;">
          Illustrative view of what happens if StaffHealth runs a focused candidate sourcing program
          (e.g., reducing workforce-pipeline risk by ~30%).
        </p>

        <h4>With Candidate Sourcing Activated</h4>
        <table>
          <thead>
            <tr>
              <th>Metric</th>
              <th>Current</th>
              <th>With Sourcing</th>
              <th>Delta</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Stability Index</td>
              <td id="currentShsiCell">–</td>
              <td id="withSourcingShsiCell">–</td>
              <td id="deltaShsiCell">–</td>
            </tr>
            <tr>
              <td>Annual Volatility Cost</td>
              <td id="currentVolCostCell">–</td>
              <td id="withSourcingVolCostCell">–</td>
              <td id="deltaVolCostCell">–</td>
            </tr>
            <tr>
              <td>Workforce Drag Cost</td>
              <td id="currentWorkforceCell">–</td>
              <td id="withSourcingWorkforceCell">–</td>
              <td id="deltaWorkforceCell">–</td>
            </tr>
          </tbody>
        </table>
        <p class="note">
          Assumes a 30% improvement in workforce stability metrics through StaffHealth candidate sourcing
          (complimentary when utilizing our platform for PRN coverage).
        </p>
      </div>
    </div>

    <p class="footer-note">
      Internal concept model — for strategy, portfolio conversations, and refinement with leadership / finance.
      The value is in framing the true cost of volatility and the upside of a StaffHealth workforce stability partnership.
    </p>
  </div>

  <script>
    function clamp(value, min, max) {
      value = Number(value);
      if (isNaN(value)) return min;
      return Math.min(Math.max(value, min), max);
    }

    function formatCurrency(amount) {
      if (isNaN(amount)) return "$–";
      const abs = Math.abs(amount);
      const sign = amount < 0 ? "-" : "";
      return sign + "$" + abs.toLocaleString(undefined, { maximumFractionDigits: 0 });
    }

    function getMode() {
      const checked = document.querySelector("input[name='mode']:checked");
      return checked ? checked.value : "single";
    }

    function updateModeUI() {
      const mode = getMode();
      const titleEl = document.getElementById("snapshotTitle");
      const subtitleEl = document.getElementById("snapshotSubtitle");
      const bannerEl = document.getElementById("modeBanner");

      if (mode === "portfolio") {
        document.body.classList.remove("mode-single");
        document.body.classList.add("mode-portfolio");
        titleEl.textContent = "Portfolio Workforce Stability Snapshot";
        subtitleEl.textContent =
          "Use distributions across your portfolio (how many communities fall into each band) to see an overall Workforce Stability Index and portfolio-wide volatility and pipeline economics.";
        bannerEl.textContent = "PORTFOLIO MODE — WORKFORCE STABILITY EDITION (WSI)";
      } else {
        document.body.classList.remove("mode-portfolio");
        document.body.classList.add("mode-single");
        titleEl.textContent = "Workforce Stability Snapshot";
        subtitleEl.textContent =
          "Adjust the inputs below to see how staffing volatility, financial exposure, operational risk, and workforce pipeline strength roll up into a single Workforce Stability Index and economic view.";
        bannerEl.textContent = "SINGLE COMMUNITY MODE — WORKFORCE STABILITY EDITION (WSI)";
      }
    }

    // Helper to compute weighted average from bands
    function weightedAverage(lowCount, midCount, highCount, lowRep, midRep, highRep) {
      const cLow = Number(lowCount) || 0;
      const cMid = Number(midCount) || 0;
      const cHigh = Number(highCount) || 0;
      const total = cLow + cMid + cHigh;
      if (total === 0) return 0;
      return (cLow * lowRep + cMid * midRep + cHigh * highRep) / total;
    }

    function getInputs() {
      const mode = getMode();

      if (mode === "single") {
        // Single community: read direct numeric values
        return {
          openShifts: clamp(document.getElementById("openShifts").value, 0, 50),
          percentPRN: clamp(document.getElementById("percentPRN").value, 0, 100),
          callOffs: clamp(document.getElementById("callOffs").value, 0, 20),
          otHours: clamp(document.getElementById("otHours").value, 0, 500),
          otPremium: clamp(document.getElementById("otPremium").value, 0, 100),
          agencyPremium: clamp(document.getElementById("agencyPremium").value, 0, 100),
          pbjRisk: clamp(document.getElementById("pbjRisk").value, 0, 10),
          surveyCitations: clamp(document.getElementById("surveyCitations").value, 0, 10),
          leaderTurnover: clamp(document.getElementById("leaderTurnover").value, 0, 10),
          turnoverRate: clamp(document.getElementById("turnoverRate").value, 0, 100),
          vacancies: clamp(document.getElementById("vacancies").value, 0, 20),
          timeToFill: clamp(document.getElementById("timeToFill").value, 0, 120),
          recruitSpend: clamp(document.getElementById("recruitSpend").value, 0, 50000)
        };
      } else {
        // Portfolio: compute weighted averages from distributions

        // Staffing volatility bands
        const openShiftsAvg = weightedAverage(
          document.getElementById("openShiftsLow").value,
          document.getElementById("openShiftsMid").value,
          document.getElementById("openShiftsHigh").value,
          3, 8, 20   // reps for 0–5, 6–10, 11+
        );

        const percentPRNAvg = weightedAverage(
          document.getElementById("percentPRNLow").value,
          document.getElementById("percentPRNMid").value,
          document.getElementById("percentPRNHigh").value,
          15, 38, 65   // reps for 0–25, 26–50, 51+
        );

        const callOffsAvg = weightedAverage(
          document.getElementById("callOffsLow").value,
          document.getElementById("callOffsMid").value,
          document.getElementById("callOffsHigh").value,
          1, 4, 7     // reps for 0–2, 3–5, 6+
        );

        // Financial exposure bands
        const otHoursAvg = weightedAverage(
          document.getElementById("otHoursLow").value,
          document.getElementById("otHoursMid").value,
          document.getElementById("otHoursHigh").value,
          60, 180, 350   // 0–100, 101–250, 251+
        );

        const otPremiumAvg = weightedAverage(
          document.getElementById("otPremiumLow").value,
          document.getElementById("otPremiumMid").value,
          document.getElementById("otPremiumHigh").value,
          15, 38, 65     // 0–25, 26–50, 51+
        );

        const agencyPremiumAvg = weightedAverage(
          document.getElementById("agencyPremiumLow").value,
          document.getElementById("agencyPremiumMid").value,
          document.getElementById("agencyPremiumHigh").value,
          10, 30, 55     // 0–20, 21–40, 41+
        );

        // Operational & compliance bands
        const pbjRiskAvg = weightedAverage(
          document.getElementById("pbjRiskLow").value,
          document.getElementById("pbjRiskMid").value,
          document.getElementById("pbjRiskHigh").value,
          1.5, 5.5, 9    // 0–3, 4–7, 8–10
        );

        const surveyCitationsAvg = weightedAverage(
          document.getElementById("surveyCitationsLow").value,
          document.getElementById("surveyCitationsMid").value,
          document.getElementById("surveyCitationsHigh").value,
          0, 1.5, 4      // 0, 1–2, 3+
        );

        const leaderTurnoverAvg = weightedAverage(
          document.getElementById("leaderTurnoverLow").value,
          document.getElementById("leaderTurnoverMid").value,
          document.getElementById("leaderTurnoverHigh").value,
          0.5, 2.5, 5    // 0–1, 2–3, 4+
        );

        // Workforce stability bands
        const turnoverRateAvg = weightedAverage(
          document.getElementById("turnoverRateLow").value,
          document.getElementById("turnoverRateMid").value,
          document.getElementById("turnoverRateHigh").value,
          20, 45, 75     // 0–30, 31–60, 61+
        );

        const vacanciesAvg = weightedAverage(
          document.getElementById("vacanciesLow").value,
          document.getElementById("vacanciesMid").value,
          document.getElementById("vacanciesHigh").value,
          0.5, 3, 6      // 0–1, 2–4, 5+
        );

        const timeToFillAvg = weightedAverage(
          document.getElementById("timeToFillLow").value,
          document.getElementById("timeToFillMid").value,
          document.getElementById("timeToFillHigh").value,
          15, 45, 90     // 0–30, 31–60, 61+
        );

        const recruitSpendAvg = weightedAverage(
          document.getElementById("recruitSpendLow").value,
          document.getElementById("recruitSpendMid").value,
          document.getElementById("recruitSpendHigh").value,
          2500, 10000, 20000   // 0–5k, 5–15k, 15k+
        );

        return {
          openShifts: openShiftsAvg,
          percentPRN: percentPRNAvg,
          callOffs: callOffsAvg,
          otHours: otHoursAvg,
          otPremium: otPremiumAvg,
          agencyPremium: agencyPremiumAvg,
          pbjRisk: pbjRiskAvg,
          surveyCitations: surveyCitationsAvg,
          leaderTurnover: leaderTurnoverAvg,
          turnoverRate: turnoverRateAvg,
          vacancies: vacanciesAvg,
          timeToFill: timeToFillAvg,
          recruitSpend: recruitSpendAvg
        };
      }
    }

    function updatePortfolioTotals() {
      const size = Number(document.getElementById("portfolioSize")?.value) || 0;

      function handleRow(lowId, midId, highId, totalSpanId) {
        const low = Number(document.getElementById(lowId)?.value) || 0;
        const mid = Number(document.getElementById(midId)?.value) || 0;
        const high = Number(document.getElementById(highId)?.value) || 0;
        const sum = low + mid + high;
        const span = document.getElementById(totalSpanId);
        if (!span) return;
        span.textContent = size > 0 ? `${sum} / ${size}` : `${sum} / 0`;

        if (size === 0) {
          span.style.color = "#555555";
        } else if (sum < size) {
          span.style.color = "#b38600"; // yellow-ish for below
        } else if (sum === size) {
          span.style.color = "#1f6b33"; // green for match
        } else if (sum > size) {
          span.style.color = "#b12c1c"; // red for over
        }
      }

      handleRow("openShiftsLow", "openShiftsMid", "openShiftsHigh", "totalOpenShifts");
      handleRow("percentPRNLow", "percentPRNMid", "percentPRNHigh", "totalPercentPRN");
      handleRow("callOffsLow", "callOffsMid", "callOffsHigh", "totalCallOffs");

      handleRow("otHoursLow", "otHoursMid", "otHoursHigh", "totalOtHours");
      handleRow("otPremiumLow", "otPremiumMid", "otPremiumHigh", "totalOtPremium");
      handleRow("agencyPremiumLow", "agencyPremiumMid", "agencyPremiumHigh", "totalAgencyPremium");

      handleRow("pbjRiskLow", "pbjRiskMid", "pbjRiskHigh", "totalPbjRisk");
      handleRow("surveyCitationsLow", "surveyCitationsMid", "surveyCitationsHigh", "totalSurveyCitations");
      handleRow("leaderTurnoverLow", "leaderTurnoverMid", "leaderTurnoverHigh", "totalLeaderTurnover");

      handleRow("turnoverRateLow", "turnoverRateMid", "turnoverRateHigh", "totalTurnoverRate");
      handleRow("vacanciesLow", "vacanciesMid", "vacanciesHigh", "totalVacancies");
      handleRow("timeToFillLow", "timeToFillMid", "timeToFillHigh", "totalTimeToFill");
      handleRow("recruitSpendLow", "recruitSpendMid", "recruitSpendHigh", "totalRecruitSpend");
    }

    function updateSHSI() {
      const inputs = getInputs();

      const openShifts = clamp(inputs.openShifts, 0, 50);
      const percentPRN = clamp(inputs.percentPRN, 0, 100);
      const callOffs = clamp(inputs.callOffs, 0, 20);

      const otHours = clamp(inputs.otHours, 0, 500);
      const otPremium = clamp(inputs.otPremium, 0, 100);
      const agencyPremium = clamp(inputs.agencyPremium, 0, 100);

      const pbjRisk = clamp(inputs.pbjRisk, 0, 10);
      const surveyCitations = clamp(inputs.surveyCitations, 0, 10);
      const leaderTurnover = clamp(inputs.leaderTurnover, 0, 10);

      const turnoverRate = clamp(inputs.turnoverRate, 0, 100);
      const vacancies = clamp(inputs.vacancies, 0, 20);
      const timeToFill = clamp(inputs.timeToFill, 0, 120);
      const recruitSpend = clamp(inputs.recruitSpend, 0, 50000);

      // Normalize each dimension to a 0–25 risk slice
      const volScore =
        ((openShifts / 50) + (percentPRN / 100) + (callOffs / 20)) / 3 * 25;

      const finScore =
        ((otHours / 500) + (otPremium / 100) + (agencyPremium / 100)) / 3 * 25;

      const opScore =
        ((pbjRisk / 10) + (surveyCitations / 10) + (leaderTurnover / 10)) / 3 * 25;

      const workforceScore =
        ((turnoverRate / 100) + (vacancies / 20) + (timeToFill / 120) + (recruitSpend / 50000)) / 4 * 25;

      const totalRisk = volScore + finScore + opScore + workforceScore;
      const shsiScore = Math.round(100 - totalRisk);

      // Economics
      const annualVolatilityCost = (totalRisk / 100) * 2000000;
      const stabilizableUpside = annualVolatilityCost * 0.4;
      const workforceDragCost = (workforceScore / 25) * 1000000;

      // Update summary UI
      const scoreEl = document.getElementById("shsiScore");
      const tagEl = document.getElementById("scoreTag");
      scoreEl.textContent = isNaN(shsiScore) ? "–" : shsiScore;

      tagEl.classList.remove("high-risk","moderate-risk","stable");
      if (shsiScore <= 50) {
        tagEl.textContent = "High Risk";
        tagEl.classList.add("high-risk");
      } else if (shsiScore <= 75) {
        tagEl.textContent = "Moderate Risk";
        tagEl.classList.add("moderate-risk");
      } else {
        tagEl.textContent = "Relatively Stable";
        tagEl.classList.add("stable");
      }

      document.getElementById("volCost").textContent = formatCurrency(annualVolatilityCost);
      document.getElementById("stabilizableUpside").textContent = formatCurrency(stabilizableUpside);
      document.getElementById("workforceDrag").textContent = formatCurrency(workforceDragCost);

      // Candidate sourcing scenario
      const improvedWorkforceScore = workforceScore * 0.7;
      const improvedTotalRisk = volScore + finScore + opScore + improvedWorkforceScore;
      const improvedShsi = Math.round(100 - improvedTotalRisk);

      const improvedVolCost = (improvedTotalRisk / 100) * 2000000;
      const improvedWorkforceDrag = (improvedWorkforceScore / 25) * 1000000;

      document.getElementById("currentShsiCell").textContent = isNaN(shsiScore) ? "–" : shsiScore;
      document.getElementById("withSourcingShsiCell").textContent = isNaN(improvedShsi) ? "–" : improvedShsi;

      const deltaShsi = improvedShsi - shsiScore;
      document.getElementById("deltaShsiCell").textContent =
        isNaN(deltaShsi) ? "–" : (deltaShsi >= 0 ? "+" + deltaShsi : deltaShsi);
      document.getElementById("deltaShsiCell").className =
        deltaShsi >= 0 ? "delta-positive" : "delta-negative";

      document.getElementById("currentVolCostCell").textContent = formatCurrency(annualVolatilityCost);
      document.getElementById("withSourcingVolCostCell").textContent = formatCurrency(improvedVolCost);
      const deltaVol = improvedVolCost - annualVolatilityCost;
      const deltaVolText = isNaN(deltaVol)
        ? "–"
        : (deltaVol <= 0 ? formatCurrency(deltaVol) : "+" + formatCurrency(deltaVol).slice(1));
      document.getElementById("deltaVolCostCell").textContent = deltaVolText;
      document.getElementById("deltaVolCostCell").className =
        deltaVol <= 0 ? "delta-positive" : "delta-negative";

      document.getElementById("currentWorkforceCell").textContent = formatCurrency(workforceDragCost);
      document.getElementById("withSourcingWorkforceCell").textContent = formatCurrency(improvedWorkforceDrag);
      const deltaWork = improvedWorkforceDrag - workforceDragCost;
      const deltaWorkText = isNaN(deltaWork)
        ? "–"
        : (deltaWork <= 0 ? formatCurrency(deltaWork) : "+" + formatCurrency(deltaWork).slice(1));
      document.getElementById("deltaWorkforceCell").textContent = deltaWorkText;
      document.getElementById("deltaWorkforceCell").className =
        deltaWork <= 0 ? "delta-positive" : "delta-negative";

      // Update portfolio totals if in portfolio mode
      updatePortfolioTotals();
    }

    document.addEventListener("DOMContentLoaded", function () {
      // Attach change listeners
      const numericInputs = document.querySelectorAll("input[type='number']");
      numericInputs.forEach(input => {
        input.addEventListener("input", function () {
          updateSHSI();
          updatePortfolioTotals();
        });
      });

      const modeInputs = document.querySelectorAll("input[name='mode']");
      modeInputs.forEach(input => {
        input.addEventListener("change", function () {
          updateModeUI();
          updateSHSI();
          updatePortfolioTotals();
        });
      });

      updateModeUI();
      updateSHSI();
      updatePortfolioTotals();
    });
  </script>
</body>
</html>
